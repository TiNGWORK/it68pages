<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.8.0"><link rel="manifest" href="/manifest.json"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>随机算法在APP安全中的重要性 | IT乐吧</title><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/tingwork/it68pages@1.33/css/main.min.css"><link rel="icon" href="//img.alicdn.com/tfscom/TB1vwgAKFXXXXaIXVXXXXXXXXXX.png" type="image/x-icon"><link rel="shortcut icon" href="//img.alicdn.com/tfscom/TB1vwgAKFXXXXaIXVXXXXXXXXXX.png"><meta content="//img.alicdn.com/tfscom/TB1vwgAKFXXXXaIXVXXXXXXXXXX.png" itemprop="image"><link rel="icon" href="//cdn.jsdelivr.net/gh/tingwork/it68pages@1.27/img/it68.svg" type="image/svg+xml"><link rel="shortcut icon" href="//cdn.jsdelivr.net/gh/tingwork/it68pages@1.27/img/it68.svg" type="image/svg+xml"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body class="home-template home blog custom-background group-blog masthead-fixed list-view full-width footer-widgets grid"><div id="page" class="hfeed site"><div id="main" class="site-main"><a id="menuLink" href="javascript:void(0);" class="menu-link"><span></span></a><div id="main-content" class="main-content"><div id="secondary"><div style="position: fixed; top: 0px;" class="site_siderbar"><h2 class="site-description"><a href="/" rel="home" titl="IT乐吧 关注生活 关注互联网 关注每一天">IT乐吧</a></h2><div id="primary-sidebar" role="complementary" class="primary-sidebar widget-area"><aside id="nav_menu-2" class="widget widget_nav_menu"><div class="menu-container"><ul id="menu" class="menu"><li class="menu-item menu-item-current menu-item-type-custom menu-item-object-custom menu-item-home"><a href="/">首页</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href="javascript:void(0);">博文</a><ul class="sub-menu"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/">技术文章</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/site-anounce/">网站公告</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/daily/">生活笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/site-anounce/">网站公告</a></li></ul></ul></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href="/about">关于我</a></li><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home"><a href="/resume-of-xiaohuilam">简历</a></li></ul></div></aside><aside id="search-3" class="widget widget_search"><form role="search" method="get" action="/search" class="search-form"><label><span class="screen-reader-text">搜索：</span><input type="text" placeholder="搜索…" value="" name="q" title="搜索：" class="search-field"></label><input type="submit" value="" class="search-submit it68icon"></form></aside></div></div></div><div id="primary" class="content-area"><div id="content" role="main" class="site-content"><article data-article-id="16" class="post type-post status-publish format-aside has-post-thumbnail hentry has-post-thumbnail article-wrap"><header class="entry-header"><span class="author-image"><img alt="" height="42" src="https://cdn.jsdelivr.net/gh/tingwork/assets@0.02/image-1.jpeg" srcset="https://cdn.jsdelivr.net/gh/tingwork/assets@0.02/image-1.jpeg 1x, https://cdn.jsdelivr.net/gh/tingwork/assets@0.02/image-1.jpeg 2x" width="42" class="avatar avatar-42 photo avatar-default"></span><div class="article_title_infos"><h1 class="entry-title"><a href="">随机算法在APP安全中的重要性</a></h1><div class="entry-meta"><span class="byline"><span class="author vcard"><a href="https://www.it68.com.cn/" rel="author" class="url fn n">蓝小灰 </a></span></span><span class="post-format"><span> </span><a href="/categories/tech/">技术文章</a><span> </span></span><span class="entry-date"><a href="" rel="bookmark"><time class="entry-date">2016-05-25</time></a></span></div></div></header><div class="entry-summary entry-content"><pre class="text-brand-wrap"><code class="text-brand serif">Random's security</code></pre><p></p><p>在展开文章之前，先给大家看一段代码:</p>
<h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">$uid = $_POST[<span class="string">'uid'</span>];</span><br><span class="line">$token = time() . rand(<span class="number">1000</span>, <span class="number">9999</span>);</span><br><span class="line">$token = md5($token);</span><br><span class="line">$redis = <span class="keyword">new</span> Redis();</span><br><span class="line">$do = $redis -&gt;setnx(<span class="string">'Auth:'</span> . $token, $uid);</span><br><span class="line"><span class="keyword">if</span>( !$do )  </span><br><span class="line">    $app-&gt;response(<span class="string">"Sorry, server is busy..."</span>);</span><br><span class="line">$app-&gt;response(<span class="string">"Hello, "</span>.$uid.<span class="string">"'s auth token is "</span>.$token);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">// 验证凭具</span></span><br><span class="line">$token = $_POST[<span class="string">'token'</span>];</span><br><span class="line">$redis = <span class="keyword">new</span> Redis();</span><br><span class="line">$uid = $redis -&gt;get(<span class="string">'Auth:'</span> . $token);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Hello, You are logged in as "</span>.$uid;</span><br></pre></td></tr></table></figure>
<h5 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h5><p>上述代码, 逻辑上并无太大问题，一般业务一秒钟能登录超过8999个用户的可能性也不太大，所以基本上能满足大多业务的APP授权需求。</p>
<p>可是这块代码真没有安全问题吗？</p>
<p>有。</p>
<p>随机生成算法太弱。</p>
<p>假设小明同学在1464158564这个时间点登录了应用，那么 md5( “1464158564” . rand( 1000, 9999 ) ) 中，除去了时间戳外就只有1000～9999是破解的变量了。只需猜8999次即可获取小明的账户权限。</p>
<h5 id="改进建议"><a href="#改进建议" class="headerlink" title="改进建议"></a>改进建议</h5><p>首先将随机因子加多，头部加尾变也加，然后长度远远大于可猜解的范围，加大暴力破解难度。</p>
<p>哈希算法改成非哈希算法，比如php的password_hash()函数替代md5()，相同因子不同次生成的密文不一致，即可以一定程度避免重复，也能无限维度加大破解难度。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">// 登录</span></span><br><span class="line">$uid = $_POST[<span class="string">'uid'</span>];</span><br><span class="line">$token = rand(<span class="number">10000000</span>, <span class="number">99999999</span>) . time() . rand(<span class="number">10000000</span>, <span class="number">99999999</span>);</span><br><span class="line">$token = password_hash($token, <span class="number">1</span>);</span><br><span class="line">$redis = <span class="keyword">new</span> Redis();</span><br><span class="line">$do = $redis -&gt;setnx(<span class="string">'Auth:'</span> . $token, $uid);</span><br><span class="line"><span class="keyword">if</span>( !$do )  </span><br><span class="line">    $app-&gt;response(<span class="string">"Sorry, server is busy..."</span>);</span><br><span class="line">$app-&gt;response(<span class="string">"Hello, "</span>.$uid.<span class="string">"'s auth token is "</span>.$token);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">// 验证凭具</span></span><br><span class="line">$token = $_POST[<span class="string">'token'</span>];</span><br><span class="line">$redis = <span class="keyword">new</span> Redis();</span><br><span class="line">$uid = $redis -&gt;get(<span class="string">'Auth:'</span> . $token);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Hello, You are logged in as "</span>.$uid;</span><br></pre></td></tr></table></figure>
<p></p></div><div class="tags"></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'iamxiazi';
var disqus_identifier = '2016/05/25/how-important-the-random-algorithm-is/';
var disqus_title = '随机算法在APP安全中的重要性';
var disqus_url = 'https://www.it68.com.cn/2016/05/25/how-important-the-random-algorithm-is/';
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = 'https://disqus.oss-cn-shanghai.aliyuncs.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();</script><noscript id="dsq-count-scr" src="https://google-c.b0.upaiyun.com/count.js" async></noscript></div></article></div></div></div></div></div><script type="text/javascript" src="//cdn.jsdelivr.net/gh/jquery/jquery@1.12.1/dist/jquery.min.js"></script><footer id="colophon" name="#ft" role="contentinfo" class="site-footer"><div id="supplementary"><div id="footer-sidebar" role="complementary" class="footer-sidebar widget-area"><aside id="tag_cloud-2" class="widget widget_tag_cloud"><h1 class="widget-title">热门标签</h1><div class="tagcloud"><a class="category-link" href="/categories/tech/">技术文章</a><a class="category-link" href="/categories/tech/site-anounce/">网站公告</a><a class="category-link" href="/categories/daily/">生活笔记</a><a class="category-link" href="/categories/site-anounce/">网站公告</a></div></aside><aside id="friend_link-1" class="widget widget_tag_cloud"><h1 class="widget-title">友情链接</h1><div class="tagcloud"><a href="https://imququ.com/" target="_blank">JerryQu</a><a href="https://hexo.io" target="_blank">Hexo</a><a href="https://github.com/xiaohuilam/" target="_blank">Github</a></div></aside></div></div><div class="site-info">Copyright © <script type="text/javascript">document.writeln('2013~'+(new Date).getFullYear());</script> <span>Xiaohui Lam</span><span> All Rights Reserved.</span><span> Powered by</span><a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><p><span>Hosted by </span><a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p></div></footer><script>if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js?t=1541314337782')
    .then(function () {console.log('ServiceWorker Register Successfully.')})
    .catch(function (e) {console.error(e)});
}
</script></body></html>